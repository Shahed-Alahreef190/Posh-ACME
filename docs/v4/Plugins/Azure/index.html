
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Posh-ACME PowerShell module">
      
      
        <meta name="author" content="Ryan Bolger">
      
      
        <link rel="canonical" href="https://poshac.me/docs/v4/Plugins/Azure/">
      
      
        <link rel="prev" href="../AutoDNS/">
      
      
        <link rel="next" href="../Beget/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Azure - Posh-ACME</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Azure - Posh-ACME" >
      
        <meta  property="og:description"  content="Documentation for the Posh-ACME PowerShell module" >
      
        <meta  property="og:image"  content="https://poshac.me/docs/v4/assets/images/social/Plugins/Azure.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://poshac.me/docs/v4/Plugins/Azure/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Azure - Posh-ACME" >
      
        <meta  name="twitter:description"  content="Documentation for the Posh-ACME PowerShell module" >
      
        <meta  name="twitter:image"  content="https://poshac.me/docs/v4/assets/images/social/Plugins/Azure.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-use-the-azure-dns-plugin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Posh-ACME" class="md-header__button md-logo" aria-label="Posh-ACME" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.181 2.974c.568 0 .923.463.792 1.035l-3.659 15.982c-.13.572-.697 1.035-1.265 1.035H.819c-.568 0-.923-.463-.792-1.035L3.686 4.009c.13-.572.697-1.035 1.265-1.035zm-8.375 9.346c.251-.394.227-.905-.09-1.243L9.122 5.125c-.38-.404-1.037-.407-1.466-.003-.429.402-.468 1.056-.088 1.46l4.662 4.96v.11l-7.42 5.374c-.45.327-.533.977-.187 1.453.346.476.991.597 1.44.27l8.229-5.91c.28-.196.438-.365.514-.52zm-2.796 4.399a.928.928 0 0 0-.934.923c0 .51.418.923.934.923h4.433a.928.928 0 0 0 .934-.923.928.928 0 0 0-.934-.923z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Posh-ACME
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rmbolger/Posh-ACME" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    rmbolger/Posh-ACME
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Tutorial/" class="md-tabs__link">
          
  
    
  
  Tutorial

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Functions/Complete-PAOrder/" class="md-tabs__link">
          
  
    
  
  Functions

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Plugins

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Guides/" class="md-tabs__link">
          
  
    
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../FAQ/" class="md-tabs__link">
          
  
    
  
  FAQ

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Posh-ACME" class="md-nav__button md-logo" aria-label="Posh-ACME" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.181 2.974c.568 0 .923.463.792 1.035l-3.659 15.982c-.13.572-.697 1.035-1.265 1.035H.819c-.568 0-.923-.463-.792-1.035L3.686 4.009c.13-.572.697-1.035 1.265-1.035zm-8.375 9.346c.251-.394.227-.905-.09-1.243L9.122 5.125c-.38-.404-1.037-.407-1.466-.003-.429.402-.468 1.056-.088 1.46l4.662 4.96v.11l-7.42 5.374c-.45.327-.533.977-.187 1.453.346.476.991.597 1.44.27l8.229-5.91c.28-.196.438-.365.514-.52zm-2.796 4.399a.928.928 0 0 0-.934.923c0 .51.418.923.934.923h4.433a.928.928 0 0 0 .934-.923.928.928 0 0 0-.934-.923z"/></svg>

    </a>
    Posh-ACME
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rmbolger/Posh-ACME" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    rmbolger/Posh-ACME
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Tutorial/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Functions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Complete-PAOrder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Complete-PAOrder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Export-PAAccountKey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Export-PAAccountKey
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Get-KeyAuthorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get-KeyAuthorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Get-PAAccount/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get-PAAccount
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Get-PAAuthorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get-PAAuthorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Get-PACertificate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get-PACertificate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Get-PAOrder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get-PAOrder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Get-PAPlugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get-PAPlugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Get-PAPluginArgs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get-PAPluginArgs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Get-PAServer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get-PAServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Install-PACertificate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install-PACertificate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Invoke-HttpChallengeListener/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Invoke-HttpChallengeListener
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/New-PAAccount/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    New-PAAccount
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/New-PAAuthorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    New-PAAuthorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/New-PACertificate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    New-PACertificate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/New-PAOrder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    New-PAOrder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Publish-Challenge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Publish-Challenge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Remove-PAAccount/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remove-PAAccount
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Remove-PAOrder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remove-PAOrder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Remove-PAServer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remove-PAServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Revoke-PAAuthorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Revoke-PAAuthorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Revoke-PACertificate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Revoke-PACertificate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Save-Challenge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Save-Challenge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Send-ChallengeAck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Send-ChallengeAck
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Set-PAAccount/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set-PAAccount
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Set-PAOrder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set-PAOrder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Set-PAServer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set-PAServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Submit-ChallengeValidation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submit-ChallengeValidation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Submit-OrderFinalize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submit-OrderFinalize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Submit-Renewal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submit-Renewal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Functions/Unpublish-Challenge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unpublish-Challenge
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Plugins
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Plugins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Plugin-Development-Guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugin Development Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AcmeDns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AcmeDns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Active24/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active24
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Akamai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Akamai
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Aliyun/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aliyun
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../All-Inkl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    All-Inkl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Aurora/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aurora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AutoDNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AutoDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Azure
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Azure
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connect-to-azure" class="md-nav__link">
    <span class="md-ellipsis">
      Connect to Azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-custom-role" class="md-nav__link">
    <span class="md-ellipsis">
      Create a Custom Role
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-create-a-service-principal-app-registration" class="md-nav__link">
    <span class="md-ellipsis">
      (Optional) Create a Service Principal / App Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="(Optional) Create a Service Principal / App Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#password-based-principal" class="md-nav__link">
    <span class="md-ellipsis">
      Password Based Principal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-based-principal-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Based Principal on Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-based-principal-on-non-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Based Principal on non-Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assign-permissions-to-the-service-principal" class="md-nav__link">
    <span class="md-ellipsis">
      Assign Permissions to the Service Principal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-using-a-managed-service-identity-msi" class="md-nav__link">
    <span class="md-ellipsis">
      (Optional) Using a Managed Service Identity (MSI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-using-an-existing-access-token" class="md-nav__link">
    <span class="md-ellipsis">
      (Optional) Using An Existing Access Token
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Plugin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#password-credential" class="md-nav__link">
    <span class="md-ellipsis">
      Password Credential
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-credential" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Credential
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Certificate Credential">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Certificate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-windows-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Windows Certificate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#existing-access-token" class="md-nav__link">
    <span class="md-ellipsis">
      Existing Access Token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-metadata-service-imds" class="md-nav__link">
    <span class="md-ellipsis">
      Instance Metadata Service (IMDS)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workaround-for-duplicate-public-zones" class="md-nav__link">
    <span class="md-ellipsis">
      Workaround for Duplicate Public Zones
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Beget/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Beget
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../BlueCat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BlueCat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bunny/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bunny
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ClouDNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ClouDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Cloudflare/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloudflare
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Combell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Combell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Constellix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Constellix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CoreNetworks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoreNetworks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DMEasy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DMEasy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DNSPod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNSPod
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DNSimple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNSimple
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DOcean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOcean
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DeSEC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeSEC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DomainOffensive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DomainOffensive
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Domeneshop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domeneshop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Dreamhost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dreamhost
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DuckDNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DuckDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Dynu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../EasyDNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EasyDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Easyname/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Easyname
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FreeDNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FreeDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GCloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GCloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Gandi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gandi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GoDaddy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GoDaddy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GoogleDomains/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GoogleDomains
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Hetzner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hetzner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../HostingDe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HostingDe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../HurricaneElectric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HurricaneElectric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../HurricaneElectricDyn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HurricaneElectricDyn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IBMSoftLayer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IBMSoftLayer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IONOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IONOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ISPConfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ISPConfig
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Infoblox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infoblox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Infomaniak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infomaniak
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LeaseWeb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LeaseWeb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Loopia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loopia
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LuaDns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LuaDns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NS1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NS1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NameCom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NameCom
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NameSilo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NameSilo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Namecheap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Namecheap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OVH/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PointDNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PointDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Porkbun/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Porkbun
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PortsManagement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PortsManagement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PowerDNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PowerDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RFC2136/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RFC2136
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rackspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rackspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Regru/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regru
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Route53/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Route53
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SSHProxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSHProxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Selectel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Selectel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SimpleDNSPlus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SimpleDNSPlus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Simply/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simply
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SimplyCom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SimplyCom
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TencentDNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TencentDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TotalUptime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TotalUptime
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../UKFast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UKFast
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WEDOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WEDOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WebRoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebRoot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WebSelfHost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebSelfHost
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WebsupportSK/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebsupportSK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Yandex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yandex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Zilore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zilore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ZoneEdit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZoneEdit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Zonomi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zonomi
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Guides/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/ACME-CA-Comparison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ACME CA Comparison
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Custom-Challenge-Validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (Advanced) Custom Challenge Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Environment-Variable-Reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Environment Variable Reference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/External-Account-Binding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External Account Binding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Find-Deprecated-PluginArgs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Find Deprecated PluginArgs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Troubleshooting-DNS-Validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting DNS Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Using-Alternate-Trust-Chains/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Alternate Trust Chains
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Using-Custom-Plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Custom Plugins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Using-DNS-Challenge-Aliases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using DNS Challenge Aliases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Using-SecretManagement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using SecretManagement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Using-an-Alternate-Config-Location/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using an Alternate Config Location
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/External-Articles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External Articles
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../FAQ/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            FAQ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connect-to-azure" class="md-nav__link">
    <span class="md-ellipsis">
      Connect to Azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-custom-role" class="md-nav__link">
    <span class="md-ellipsis">
      Create a Custom Role
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-create-a-service-principal-app-registration" class="md-nav__link">
    <span class="md-ellipsis">
      (Optional) Create a Service Principal / App Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="(Optional) Create a Service Principal / App Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#password-based-principal" class="md-nav__link">
    <span class="md-ellipsis">
      Password Based Principal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-based-principal-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Based Principal on Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-based-principal-on-non-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Based Principal on non-Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assign-permissions-to-the-service-principal" class="md-nav__link">
    <span class="md-ellipsis">
      Assign Permissions to the Service Principal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-using-a-managed-service-identity-msi" class="md-nav__link">
    <span class="md-ellipsis">
      (Optional) Using a Managed Service Identity (MSI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-using-an-existing-access-token" class="md-nav__link">
    <span class="md-ellipsis">
      (Optional) Using An Existing Access Token
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Plugin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#password-credential" class="md-nav__link">
    <span class="md-ellipsis">
      Password Credential
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-credential" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Credential
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Certificate Credential">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Certificate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-windows-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Windows Certificate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#existing-access-token" class="md-nav__link">
    <span class="md-ellipsis">
      Existing Access Token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-metadata-service-imds" class="md-nav__link">
    <span class="md-ellipsis">
      Instance Metadata Service (IMDS)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workaround-for-duplicate-public-zones" class="md-nav__link">
    <span class="md-ellipsis">
      Workaround for Duplicate Public Zones
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/rmbolger/Posh-ACME/edit/main/docs/Plugins/Azure.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/rmbolger/Posh-ACME/raw/main/docs/Plugins/Azure.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="how-to-use-the-azure-dns-plugin">How To Use the Azure DNS Plugin<a class="headerlink" href="#how-to-use-the-azure-dns-plugin" title="Permanent link">&para;</a></h1>
<p>This plugin works against the <a href="https://azure.microsoft.com/en-us/services/dns/">Azure DNS</a> provider. It is assumed that you already have an active subscription with at least one DNS zone, associated Resource Group, and an account with access to create roles and app registrations. The setup commands used in this guide will also make use of the <a href="https://www.powershellgallery.com/packages/Az/">Az</a> module. But it is not required to use the plugin normally.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<p>This plugin has three distinct methods for authentication against Azure. The first involves specifying a Tenant ID and credentials for an account or app registration. The second requires an existing <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-protocols-oauth-code">OAuth 2.0 access token</a> which would generally be used for short lived services or environments where Azure authentication is being handled externally to the Posh-ACME module. The last is for systems running within Azure that have a <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-service-identity/overview">Managed Service Identity (MSI)</a> and utilizes the <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service">Instance Metadata Service (IMDS)</a> to request an access token.</p>
<p>All methods require that the identity being used to authenticate has been given access to modify TXT records in the specified Azure subscription. If you have already done that, you can skip most of the following setup.</p>
<h3 id="connect-to-azure">Connect to Azure<a class="headerlink" href="#connect-to-azure" title="Permanent link">&para;</a></h3>
<p>Using an account with access to create roles and app registrations, connect to Azure with the following commands. We'll be saving the resulting Subscription and Tenant ID values for later.</p>
<div class="highlight"><pre><span></span><code><span class="c"># On Windows, this will pop up a web-GUI to login with. On other OSes,</span>
<span class="c"># it will ask you to open a browser separately with a code for logging in.</span>
<span class="nv">$az</span> <span class="p">=</span> <span class="nb">Connect-AzAccount</span>

<span class="c"># Save the subscription/tentant ID for later</span>
<span class="nv">$subscriptionID</span> <span class="p">=</span> <span class="nv">$az</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">Subscription</span><span class="p">.</span><span class="n">Id</span>
<span class="nv">$tenantID</span> <span class="p">=</span> <span class="nv">$az</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">Subscription</span><span class="p">.</span><span class="n">TenantId</span>
</code></pre></div>
<h3 id="create-a-custom-role">Create a Custom Role<a class="headerlink" href="#create-a-custom-role" title="Permanent link">&para;</a></h3>
<p>We're going to create a custom role that is limited to modifying TXT records in whatever resource group it is assigned to. It will be based on the default <code>DNS Zone Contributor</code> role.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$roleDef</span> <span class="p">=</span> <span class="nb">Get-AzRoleDefinition</span> <span class="n">-Name</span> <span class="s2">&quot;DNS Zone Contributor&quot;</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="nv">$null</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;DNS TXT Contributor&quot;</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Description</span> <span class="p">=</span> <span class="s2">&quot;Manage DNS TXT records only.&quot;</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">RemoveRange</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;Microsoft.Network/dnsZones/TXT/*&quot;</span><span class="p">)</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;Microsoft.Network/dnsZones/read&quot;</span><span class="p">)</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;Microsoft.Authorization/*/read&quot;</span><span class="p">)</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;Microsoft.Insights/alertRules/*&quot;</span><span class="p">)</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;Microsoft.ResourceHealth/availabilityStatuses/read&quot;</span><span class="p">)</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;Microsoft.Resources/deployments/read&quot;</span><span class="p">)</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;Microsoft.Resources/subscriptions/resourceGroups/read&quot;</span><span class="p">)</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">AssignableScopes</span><span class="p">.</span><span class="n">Clear</span><span class="p">()</span>
<span class="nv">$roleDef</span><span class="p">.</span><span class="n">AssignableScopes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;/subscriptions/</span><span class="p">$(</span><span class="nv">$az</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">Subscription</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nv">$role</span> <span class="p">=</span> <span class="nb">New-AzRoleDefinition</span> <span class="nv">$roleDef</span>
<span class="nv">$role</span>
</code></pre></div>
<h3 id="optional-create-a-service-principal-app-registration">(Optional) Create a Service Principal / App Registration<a class="headerlink" href="#optional-create-a-service-principal-app-registration" title="Permanent link">&para;</a></h3>
<p>If you're using Posh-ACME from outside Azure and not using an existing access token, it is wise to create a dedicated service principal limited to modifying TXT records. Service Principals are tied to App Registrations in Azure AD and creating the former will automatically create the latter (though it's technically possible to create them separately).</p>
<p>Service Principals are associated with one or more Credentials which can be password or certificated based. Certificates can be a bit trickier to setup particularly on non-Windows OSes, but Microsoft recommends them over passwords. We'll go over both methods below. Both also have configurable expiration values that default to 1 year and we'll be setting ours to 5 years, but you can choose whatever you like.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$notBefore</span> <span class="p">=</span> <span class="nb">Get-Date</span>
<span class="nv">$notAfter</span> <span class="p">=</span> <span class="nv">$notBefore</span><span class="p">.</span><span class="n">AddYears</span><span class="p">(</span><span class="n">5</span><span class="p">)</span>
</code></pre></div>
<h4 id="password-based-principal">Password Based Principal<a class="headerlink" href="#password-based-principal" title="Permanent link">&para;</a></h4>
<p>The <code>New-AzADServicePrincipal</code> function will generate a password for us, so all we have to do is give it a name and specify our expiration dates.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$spParams</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">DisplayName</span> <span class="p">=</span> <span class="s1">&#39;PoshACME&#39;</span>
    <span class="n">StartDate</span> <span class="p">=</span> <span class="nv">$notBefore</span>
    <span class="n">EndDate</span> <span class="p">=</span> <span class="nv">$notAfter</span>
<span class="p">}</span>
<span class="nv">$sp</span> <span class="p">=</span> <span class="nb">New-AzADServicePrincipal</span> <span class="nv">@spParams</span>
</code></pre></div>
<p>You'll use your new credential with the <code>AZAppCred</code> plugin parameter. The username is in the <code>AppId</code> property and the password is in <code>PasswordCredentials.SecretText</code>. Here's how to create the credential object for later.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$spPass</span> <span class="p">=</span> <span class="nv">$sp</span><span class="p">.</span><span class="n">PasswordCredentials</span><span class="p">.</span><span class="n">SecretText</span> <span class="p">|</span> <span class="nb">ConvertTo-SecureString</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
<span class="nv">$appCred</span> <span class="p">=</span> <span class="no">[pscredential]</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="nv">$sp</span><span class="p">.</span><span class="n">AppId</span><span class="p">,</span><span class="nv">$spPass</span><span class="p">)</span>
</code></pre></div>
<h4 id="certificate-based-principal-on-windows">Certificate Based Principal on Windows<a class="headerlink" href="#certificate-based-principal-on-windows" title="Permanent link">&para;</a></h4>
<p>Before we can create a certificate based credential, we have to actually create a certificate to use with it. Self-signed certs are fine here because we're only using them to sign data and Azure just needs to verify the signature using the public key we will associate with the principal.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>New-SelfSignedCertificate is only available on Windows 10/2016 or later. Check <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-authenticate-service-principal-powershell">this document</a> for instructions on earlier OSes.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you plan on using an existing certificate, make sure it is being stored using the legacy CSP called "Microsoft Enhanced RSA and AES Cryptographic Provider" that supports the SHA256 hashing algorithm. PowerShell doesn't yet support retrieving private key values from newer KSP based providers.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c"># Keep in mind that this certificate will be created in the current user&#39;s certificate</span>
<span class="c"># store. If you intend to use it from another account, you will need to either create it</span>
<span class="c"># there or export it and re-import it there.</span>
<span class="nv">$certParams</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">CertStoreLocation</span> <span class="p">=</span> <span class="s1">&#39;Cert:\CurrentUser\My&#39;</span>
    <span class="n">Subject</span> <span class="p">=</span> <span class="s1">&#39;CN=Azure App PoshACME&#39;</span>
    <span class="n">HashAlgorithm</span> <span class="p">=</span> <span class="s1">&#39;SHA256&#39;</span>
    <span class="n">Provider</span> <span class="p">=</span> <span class="s1">&#39;Microsoft Enhanced RSA and AES Cryptographic Provider&#39;</span>
    <span class="n">NotBefore</span> <span class="p">=</span> <span class="nv">$notBefore</span>
    <span class="n">NotAfter</span> <span class="p">=</span> <span class="nv">$notAfter</span>
<span class="p">}</span>
<span class="nv">$cert</span> <span class="p">=</span> <span class="nb">New-SelfSignedCertificate</span> <span class="nv">@certParams</span>

<span class="nv">$certData</span> <span class="p">=</span> <span class="no">[System.Convert]</span><span class="p">::</span><span class="n">ToBase64String</span><span class="p">(</span><span class="nv">$cert</span><span class="p">.</span><span class="n">GetRawCertData</span><span class="p">())</span>

<span class="nv">$spParams</span> <span class="p">=</span> <span class="p">@{</span>
  <span class="n">DisplayName</span> <span class="p">=</span> <span class="s1">&#39;PoshACME&#39;</span>
  <span class="n">CertValue</span> <span class="p">=</span> <span class="nv">$certData</span>
  <span class="n">StartDate</span> <span class="p">=</span> <span class="nv">$cert</span><span class="p">.</span><span class="n">NotBefore</span>
  <span class="n">EndDate</span> <span class="p">=</span> <span class="nv">$cert</span><span class="p">.</span><span class="n">NotAfter</span>
<span class="p">}</span>
<span class="nv">$sp</span> <span class="p">=</span> <span class="nb">New-AzADServicePrincipal</span> <span class="nv">@spParams</span>
</code></pre></div>
<p>You'll use your new credential with the <code>AZAppUsername</code> and <code>AZCertThumbprint</code> plugin parameters. Here's how to save a reference to them for later.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$appUser</span> <span class="p">=</span> <span class="nv">$sp</span><span class="p">.</span><span class="n">AppId</span>
<span class="nv">$thumbprint</span> <span class="p">=</span> <span class="nv">$cert</span><span class="p">.</span><span class="n">Thumbprint</span>
</code></pre></div>
<h4 id="certificate-based-principal-on-non-windows">Certificate Based Principal on non-Windows<a class="headerlink" href="#certificate-based-principal-on-non-windows" title="Permanent link">&para;</a></h4>
<p>Before we can create a certificate based credential, we have to actually create a certificate to use with it. As of PowerShell 6.2.3, the non-Windows support for .NET's certificate store abstraction is still not great. So we need to create the cert with OpenSSL and reference a PFX file directly rather than using the thumbprint value like on Windows. Self-signed certs are fine here because we're only using them to sign data and Azure just needs to verify the signature using the public key we will associate with the principal.</p>
<div class="highlight"><pre><span></span><code><span class="c"># Depending on your OpenSSL config, this may prompt you for certificate details</span>
<span class="c"># like Country, Organization, etc. None of the details matter for the purposes of</span>
<span class="c"># authentication and can be set to anything you like.</span>
<span class="n">openssl</span> <span class="n">req</span> <span class="n">-x509</span> <span class="n">-nodes</span> <span class="n">-sha256</span> <span class="n">-days</span> <span class="n">1826</span> <span class="n">-newkey</span> <span class="n">rsa</span><span class="p">:</span><span class="n">2048</span> <span class="n">-keyout</span> <span class="n">poshacme</span><span class="p">.</span><span class="n">key</span> <span class="n">-out</span> <span class="n">poshacme</span><span class="p">.</span><span class="n">crt</span>

<span class="c"># change the export password to whatever you want, but remember what it is so you can</span>
<span class="c"># provide it as part of the plugin parameters</span>
<span class="n">openssl</span> <span class="n">pkcs12</span> <span class="n">-export</span> <span class="n">-in</span> <span class="n">poshacme</span><span class="p">.</span><span class="n">crt</span> <span class="n">-inkey</span> <span class="n">poshacme</span><span class="p">.</span><span class="n">key</span> <span class="n">-CSP</span> <span class="s2">&quot;Microsoft Enhanced RSA and AES Cryptographic Provider&quot;</span> <span class="n">-out</span> <span class="n">poshacme</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-passout</span> <span class="s2">&quot;pass:poshacme&quot;</span>

<span class="nv">$cert</span> <span class="p">=</span> <span class="no">[Security.Cryptography.X509Certificates.X509Certificate2]</span><span class="p">::</span><span class="n">new</span><span class="p">((</span><span class="nb">Resolve-Path</span> <span class="s1">&#39;./poshacme.crt&#39;</span><span class="p">))</span>
<span class="nv">$certData</span> <span class="p">=</span> <span class="no">[Convert]</span><span class="p">::</span><span class="n">ToBase64String</span><span class="p">(</span><span class="nv">$cert</span><span class="p">.</span><span class="n">GetRawCertData</span><span class="p">())</span>

<span class="nv">$spParams</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">DisplayName</span> <span class="p">=</span> <span class="s1">&#39;PoshACMELinux&#39;</span>
    <span class="n">CertValue</span> <span class="p">=</span> <span class="nv">$certData</span>
    <span class="n">StartDate</span> <span class="p">=</span> <span class="nv">$cert</span><span class="p">.</span><span class="n">NotBefore</span>
    <span class="n">EndDate</span> <span class="p">=</span> <span class="nv">$cert</span><span class="p">.</span><span class="n">NotAfter</span>
<span class="p">}</span>
<span class="nv">$sp</span> <span class="p">=</span> <span class="nb">New-AzADServicePrincipal</span> <span class="nv">@spParams</span>

<span class="c"># (optional) delete the PEM files we don&#39;t need for plugin purposes</span>
<span class="nb">rm </span><span class="n">poshacme</span><span class="p">.</span><span class="n">crt</span> <span class="n">poshacme</span><span class="p">.</span><span class="n">key</span>

<span class="c"># IMPORTANT: Anyone who can read the crt/key or pfx files may be able to impersonate this</span>
<span class="c"># service principal. So make sure to move and/or change permissions on the files so</span>
<span class="c"># that only the process running Posh-ACME can read them.</span>
</code></pre></div>
<p>You'll use your new credential with the <code>AZAppUsername</code>, <code>AZCertPfx</code>, and <code>AZPfxPassSecure</code> plugin parameters. Here's how to save a reference to them for later.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$appUser</span> <span class="p">=</span> <span class="nv">$sp</span><span class="p">.</span><span class="n">AppId</span>
<span class="c"># modify the path and/or password as appropriate</span>
<span class="nv">$certPfx</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Resolve-Path</span> <span class="s1">&#39;./poshacme.pfx&#39;</span><span class="p">).</span><span class="n">ToString</span><span class="p">()</span>
<span class="c"># remember to use the password you used with openssl</span>
<span class="nv">$pfxPass</span> <span class="p">=</span> <span class="n">ConvertToSecureString</span> <span class="s1">&#39;poshacme&#39;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
</code></pre></div>
<h3 id="assign-permissions-to-the-service-principal">Assign Permissions to the Service Principal<a class="headerlink" href="#assign-permissions-to-the-service-principal" title="Permanent link">&para;</a></h3>
<p>Now we'll tie everything together by assigning the service principal we created to the custom Role we created and the Resource Group that contains our DNS zones. If your zones are in more than one resource group, just repeat this for each one. If you used your own method for creating a service princpal, just use <code>Get-AzAdServicePrincipal</code> to get a reference to it first.</p>
<div class="highlight"><pre><span></span><code><span class="c"># modify the ResourceGroupName as appropriate for your environment</span>
<span class="nv">$raParams</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">ApplicationId</span> <span class="p">=</span> <span class="nv">$sp</span><span class="p">.</span><span class="n">AppId</span>
    <span class="n">ResourceGroupName</span> <span class="p">=</span> <span class="s1">&#39;MyZones&#39;</span>
    <span class="n">RoleDefinitionName</span> <span class="p">=</span> <span class="s1">&#39;DNS TXT Contributor&#39;</span>
<span class="p">}</span>
<span class="nb">New-AzRoleAssignment</span> <span class="nv">@raParams</span>
</code></pre></div>
<h3 id="optional-using-a-managed-service-identity-msi">(Optional) Using a Managed Service Identity (MSI)<a class="headerlink" href="#optional-using-a-managed-service-identity-msi" title="Permanent link">&para;</a></h3>
<p>When using a <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-service-identity/overview">Managed Service Identity (MSI)</a>, we need the security principal ID of the VM or Service to assign permissions to. This example will query a VM.</p>
<div class="highlight"><pre><span></span><code><span class="c"># NOTE: The VM must have a managed identity associated with it for this to work</span>
<span class="nv">$spID</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="s1">&#39;&lt;VM Resource Group&gt;&#39;</span> <span class="n">-Name</span> <span class="s1">&#39;&lt;VM Name&gt;&#39;</span><span class="p">).</span><span class="n">Identity</span><span class="p">.</span><span class="n">PrincipalId</span>
<span class="nv">$raParams</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">ObjectId</span> <span class="p">=</span> <span class="nv">$spID</span>
    <span class="n">ResourceGroupName</span> <span class="p">=</span> <span class="s1">&#39;MyZones&#39;</span>
    <span class="n">RoleDefinitionName</span> <span class="p">=</span> <span class="s1">&#39;DNS TXT Contributor&#39;</span>
<span class="p">}</span>
<span class="nb">New-AzRoleAssignment</span> <span class="nv">@raParams</span>
</code></pre></div>
<p>In addition to the <code>AZSubscriptionId</code> plugin parameter that all auth methods must provide, the only plugin parameter you'll need is the <code>AZUseIMDS</code> switch.</p>
<h3 id="optional-using-an-existing-access-token">(Optional) Using An Existing Access Token<a class="headerlink" href="#optional-using-an-existing-access-token" title="Permanent link">&para;</a></h3>
<p>Any existing user, application, or managed service principal should work as long as it has been assigned permissions to manage DNS TXT records in the zones you're requesting certificates for.</p>
<p>Here is how to get the token for the context you are currently logged in with using with Powershell. The method depends on what version of the <code>Az.Accounts</code> module you're using.</p>
<div class="highlight"><pre><span></span><code><span class="c"># Az.Accounts 1.9.x or earlier</span>
<span class="nv">$ctx</span> <span class="p">=</span> <span class="nb">Get-AzContext</span>
<span class="nv">$token</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$ctx</span><span class="p">.</span><span class="n">TokenCache</span><span class="p">.</span><span class="n">ReadItems</span><span class="p">()</span> <span class="p">|</span> <span class="p">?{</span>
    <span class="nv">$_</span><span class="p">.</span><span class="n">TenantId</span> <span class="o">-eq</span> <span class="nv">$ctx</span><span class="p">.</span><span class="n">Subscription</span><span class="p">.</span><span class="n">TenantId</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Resource</span> <span class="o">-eq</span> <span class="s2">&quot;https://management.core.windows.net/&quot;</span>
<span class="p">}</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">AccessToken</span>

<span class="c"># Az.Accounts 2.0.x or later</span>
<span class="nv">$token</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-AzAccessToken</span> <span class="n">-ResourceUrl</span> <span class="s2">&quot;https://management.core.windows.net/&quot;</span> <span class="n">-TenantId</span> <span class="nv">$tenantId</span><span class="p">).</span><span class="n">Token</span>
</code></pre></div>
<p>Here's a similar method using Azure CLI 2.0.
<div class="highlight"><pre><span></span><code><span class="c"># show all subscriptions - the one marked as &quot;isDefault&quot;: true will be used to create the token</span>
<span class="n">az</span> <span class="n">account</span> <span class="n">list</span>
<span class="nv">$token</span> <span class="p">=</span> <span class="p">(</span><span class="n">az</span> <span class="n">account</span> <span class="nb">get-access</span><span class="n">-token</span> <span class="p">-</span><span class="n">-resource</span> <span class="s1">&#39;https://management.core.windows.net/&#39;</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span><span class="p">).</span><span class="n">accessToken</span>
</code></pre></div></p>
<p>To get a token for the MSI when running in a VM, Azure Function or App Service - please refer to the following documentation. Remember to pass in the correct resource uri: <strong>https://management.core.windows.net/</strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-service-identity/how-to-use-vm-token">Getting a token for an MSI-enabled VM</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/app-service/app-service-managed-service-identity">Getting a token for an MSI-enabled App Service or Function</a></li>
</ul>
<h2 id="using-the-plugin">Using the Plugin<a class="headerlink" href="#using-the-plugin" title="Permanent link">&para;</a></h2>
<p>All authentication methods require specifying <code>AZSubscriptionId</code> which is the subscription that contains the DNS zones to modify. Password and Certificate based credentials also require <code>AZTenantId</code> which is the Azure AD tenant guid. Additional parameters are outlined in each section below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The plugin defaults to using the primary public Azure Cloud. But country and government specific Azure clouds are also supported by specifying the <code>AZEnvironment</code> parameter. Supported environments include <code>AzureCloud</code> (Default), <code>AzureUSGovernment</code>, <code>AzureGermanCloud</code>, and <code>AzureChinaCloud</code>.</p>
</div>
<h3 id="password-credential">Password Credential<a class="headerlink" href="#password-credential" title="Permanent link">&para;</a></h3>
<p>Subscription and Tenant values are passed as standard strings using <code>AZSubscriptionId</code> and <code>AZTenantId</code>. The credential is passed as a PSCredential object using <code>AZAppCred</code>. PSCredential objects require a username and password. For a service principal, the username is the its <code>ApplicationId</code> guid and the password is whatever was originally set for it. If you've been following the setup instructions, you may have <code>$subscriptionID</code>, <code>$tenantID</code>, and <code>$appCred</code> variables you can use instead of the sample values below.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>AZAppUsername</code> and <code>AZAppPasswordInsecure</code> parameters are deprecated and will be removed in the next major module version. If you are using them, please migrate to a secure parameter set.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="nv">$pArgs</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">AZSubscriptionId</span> <span class="p">=</span> <span class="s1">&#39;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#39;</span>
    <span class="n">AZTenantId</span> <span class="p">=</span> <span class="s1">&#39;yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy&#39;</span>
    <span class="n">AZAppCred</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span>
<span class="p">}</span>
<span class="nb">New-PACertificate</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="n">-Plugin</span> <span class="n">Azure</span> <span class="n">-PluginArgs</span> <span class="nv">$pArgs</span>
</code></pre></div>
<h3 id="certificate-credential">Certificate Credential<a class="headerlink" href="#certificate-credential" title="Permanent link">&para;</a></h3>
<p>As of PowerShell 6.2.3 (November 2019), support for the certificate store abstractions only really works on Windows. So there are separate instructions for Windows and non-Windows OSes.</p>
<h4 id="windows-certificate">Windows Certificate<a class="headerlink" href="#windows-certificate" title="Permanent link">&para;</a></h4>
<p>You'll need to specify the service principal username which is its <code>ApplicationId</code> guid and the certificate thumbprint value. If you've been following the setup instructions, you may have <code>$subscriptionID</code>, <code>$tenantID</code>, <code>$appUser</code>, and <code>$thumbprint</code> variables you can use instead of the sample values below.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$pArgs</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">AZSubscriptionId</span> <span class="p">=</span> <span class="s1">&#39;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#39;</span>
    <span class="n">AZTenantId</span> <span class="p">=</span> <span class="s1">&#39;yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy&#39;</span>
    <span class="n">AZAppUsername</span> <span class="p">=</span> <span class="s1">&#39;zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz&#39;</span>
    <span class="n">AZCertThumbprint</span> <span class="p">=</span> <span class="s1">&#39;1A2B3C4D5E6F1A2B3C4D5E6F1A2B3C4D5E6F1A2B&#39;</span>
<span class="p">}</span>
<span class="nb">New-PACertificate</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="n">-Plugin</span> <span class="n">Azure</span> <span class="n">-PluginArgs</span> <span class="nv">$pArgs</span>
</code></pre></div>
<h4 id="non-windows-certificate">Non-Windows Certificate<a class="headerlink" href="#non-windows-certificate" title="Permanent link">&para;</a></h4>
<p>You'll need to specify the service principal username which is its <code>ApplicationId</code> guid, the path to the PFX file, and the PFX password as a SecureString. If you've been following the setup instructions, you may have <code>$subscriptionID</code>, <code>$tenantID</code>, <code>$appUser</code>, <code>$certPfx</code>, and <code>$pfxPass</code> variables you can use instead of the sample values below.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>AZPfxPass</code> parameter is deprecated and will be removed in the next major module version. If you are using it, please migrate to a secure parameter set.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="nv">$pArgs</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">AZSubscriptionId</span> <span class="p">=</span> <span class="s1">&#39;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#39;</span>
    <span class="n">AZTenantId</span> <span class="p">=</span> <span class="s1">&#39;yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy&#39;</span>
    <span class="n">AZAppUsername</span> <span class="p">=</span> <span class="s1">&#39;zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz&#39;</span>
    <span class="n">AZCertPfx</span> <span class="p">=</span> <span class="s1">&#39;/home/certuser/poshacme.pfx&#39;</span>
    <span class="n">AZPfxPassSecure</span> <span class="p">=</span> <span class="p">(</span><span class="nb">ConvertTo-SecureString</span> <span class="s1">&#39;poshacme&#39;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span><span class="p">)</span>
<span class="p">}</span>
<span class="nb">New-PACertificate</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="n">-Plugin</span> <span class="n">Azure</span> <span class="n">-PluginArgs</span> <span class="nv">$pArgs</span>
</code></pre></div>
<h3 id="existing-access-token">Existing Access Token<a class="headerlink" href="#existing-access-token" title="Permanent link">&para;</a></h3>
<p>Only the subscription guid and the access token you previously retrieved are required for this method.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$pArgs</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">AZSubscriptionId</span> <span class="p">=</span> <span class="s1">&#39;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#39;</span>
    <span class="n">AZAccessToken</span> <span class="p">=</span> <span class="nv">$token</span>
<span class="p">}</span>
<span class="nb">New-PACertificate</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="n">-Plugin</span> <span class="n">Azure</span> <span class="n">-PluginArgs</span> <span class="nv">$pArgs</span>
</code></pre></div>
<h3 id="instance-metadata-service-imds">Instance Metadata Service (IMDS)<a class="headerlink" href="#instance-metadata-service-imds" title="Permanent link">&para;</a></h3>
<p>Only the subscription guid and the <code>AZUseIMDS</code> switch are required for this method.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$pArgs</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">AZSubscriptionId</span> <span class="p">=</span> <span class="s1">&#39;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#39;</span>
    <span class="n">AZUseIMDS</span> <span class="p">=</span> <span class="nv">$true</span>
<span class="p">}</span>
<span class="nb">New-PACertificate</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="n">-Plugin</span> <span class="n">Azure</span> <span class="n">-PluginArgs</span> <span class="nv">$pArgs</span>
</code></pre></div>
<h2 id="workaround-for-duplicate-public-zones">Workaround for Duplicate Public Zones<a class="headerlink" href="#workaround-for-duplicate-public-zones" title="Permanent link">&para;</a></h2>
<p>In rare cases, a subscription may have two or more public copies of the same zone in different resource groups. When this happens, the plugin will throw an error such as:</p>
<blockquote>
<p>2 public copies of example.com zone found. Please use 'poshacme' tag on the live copy.</p>
</blockquote>
<p>To workaround this problem, there are two main options. The easiest is to add an <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-using-tags">Azure Tag</a> called <code>poshacme</code> on the live copy of the zone. The tag value doesn't matter as long as the name is <code>poshacme</code>. The plugin will recognize this tag and ignore the other copies of the zone. (Note: This requires version 3.2.1 of the module or later)</p>
<p>The other solution is to remove permissions from the Azure account being used with Posh-ACME so it can only see the resource group that contains the live copy of the zone. But this may not be feasible depending on what else is in the resource group and what else the Azure account is being used for.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../AutoDNS/" class="md-footer__link md-footer__link--prev" aria-label="Previous: AutoDNS">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                AutoDNS
              </div>
            </div>
          </a>
        
        
          
          <a href="../Beget/" class="md-footer__link md-footer__link--next" aria-label="Next: Beget">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Beget
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 Ryan Bolger
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/rmbolger" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
    
    
    
      
      
    
    <a href="https://mastodon.social/@rmbolger" target="_blank" rel="noopener me" title="mastodon.social" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/rmbolger/" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.footer", "content.code.copy", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>